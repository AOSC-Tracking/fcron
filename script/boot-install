#!/bin/sh
# Install fcron under SysV system.
#

# $Id: boot-install,v 1.12 2000-11-03 13:22:00 thib Exp $

# take 3 arguments : the name of the BSD-like install program
#                    the DESTSBIN directory, and the value of DEBUG

PATH="/sbin:/usr/sbin:/bin:/usr/bin:/usr/X11R6/bin"

startdir=$pwd
#DEBUG=$3
DEBUG=1

if test $# -ne 3; then
    echo "Too few/many arguments"
    exit 1
fi

if test $DEBUG -eq 1; then
    STARTCMD="fcron -b -d"
else
    STARTCMD="fcron -b"
fi    

if test -f /etc/rc.d/rc.M; then
    # Slackware
    if ! cat /etc/rc.d/rc.local | grep $STARTCMD; then
	echo $STARTCMD >> /etc/rc.d/rc.local
    fi
    killall -TERM fcron
    fcron-launcher
fi 
if test -f /etc/rc; then
    # FreeBSD
    if ! cat /etc/rc.local | grep $STARTCMD; then
	echo $STARTCMD >> /etc/rc.local
    fi
    killall -TERM fcron
    fcron-launcher
fi
ROOTDIR=""
if test -d /etc/rc.d/init.d/; then
    ROOTDIR="/etc/rc.d"
elif test -d /etc/init.d/; then
    ROOTDIR="/etc"
fi
if test $ROOTDIR != ""; then
    $1 -c -m 755 -o root sysVinit-launcher $ROOTDIR/init.d/fcron
    if test $DEBUG -eq 1; then
	cat $ROOTDIR/init.d/fcron | sed 's: -b: -b -d:' >$ROOTDIR/init.d/fcron2
	mv -f $ROOTDIR/init.d/fcron2 $ROOTDIR/init.d/fcron
	chmod +x $ROOTDIR/init.d/fcron
    fi
    cat $ROOTDIR/init.d/fcron | sed "s:@@DESTSBIN@:$2:" >$ROOTDIR/init.d/fcron2
    mv -f $ROOTDIR/init.d/fcron2 $ROOTDIR/init.d/fcron
    chmod +x $ROOTDIR/init.d/fcron
    
    cd $ROOTDIR/rc2.d/ ; ln -f -s ../init.d/fcron S40fcron
    cd $ROOTDIR/rc3.d/ ; ln -f -s ../init.d/fcron S40fcron
    cd $ROOTDIR/rc4.d/ ; ln -f -s ../init.d/fcron S40fcron
    cd $ROOTDIR/rc5.d/ ; ln -f -s ../init.d/fcron S40fcron
    
    cd $ROOTDIR/rc0.d/ ; ln -f -s ../init.d/fcron  K60fcron
    cd $ROOTDIR/rc6.d/ ; ln -f -s ../init.d/fcron  K60fcron
    cd $startdir

    # we stop fcron like this (not using "fcron restart") because
    # an old version of fcron may not stop correctly otherwise.
    killall -TERM fcron
    $ROOTDIR/init.d/fcron start
fi

